sequenceDiagram
    participant U as User
    participant App as Application
    participant Auth as AuthManager
    participant SM as SyncManager
    participant EM as EditorManager
    participant GM as GraphManager
    participant ST as StorageManager
    participant SB as Supabase

    %% Login Flow
    U->>App: Open application
    App->>Auth: Check auth status
    Auth->>SB: Verify session
    alt Not logged in
        SB-->>Auth: No valid session
        Auth-->>App: Redirect to login
        U->>App: Click Google login
        App->>SB: Initiate OAuth
        SB-->>App: Return JWT
        App->>ST: Initialize local storage
    else Logged in
        SB-->>Auth: Valid session
        Auth-->>App: User authenticated
    end

    %% Initial Data Load
    App->>SM: Start sync
    SM->>SB: Fetch documents
    SB-->>SM: Return documents
    SM->>ST: Store locally
    SM->>GM: Build graph
    GM-->>App: Display graph

    %% Document Editing
    U->>App: Open document
    App->>EM: Load document
    EM->>ST: Get from storage
    ST-->>EM: Return content
    EM-->>App: Display editor

    U->>App: Edit document
    App->>EM: Update content
    EM->>EM: Parse markdown
    EM-->>App: Update preview
    EM->>ST: Auto-save (debounced)
    ST->>SM: Queue sync

    %% Background Sync
    SM->>SB: Sync changes
    alt Successful sync
        SB-->>SM: Confirm sync
        SM->>ST: Update sync timestamp
    else Conflict
        SB-->>SM: Return conflict
        SM->>SM: Resolve conflict
        SM->>SB: Push resolution
    end

    %% Graph Update
    EM->>GM: Parse document links
    GM->>GM: Update graph data
    GM-->>App: Refresh visualization